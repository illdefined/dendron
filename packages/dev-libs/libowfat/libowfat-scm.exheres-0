# Copyright MMXI
#     Mikael Voss <mikael+exherbo@illdefined.org>
# Distributed under the terms of the GNU General Public License v2

SUMMARY="Fefe’s reimplementation of libdjb"
HOMEPAGE="http://www.fefe.de/${PN}/"
SCM_REPOSITORY=":pserver:cvs@cvs.fefe.de:/cvs"

require scm-cvs purify

REMOTE_IDS="freecode:${PN}"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64 ~x86"

src_prepare() {
	default

	CFLAGS="${CPPFLAGS} ${CFLAGS}"

	edo rm Makefile
	purify "GNUmakefile" \
		"CC" "CFLAGS" \
		"prefix=${IMAGE}/usr" \
		"LIBDIR=${IMAGE}/usr/${LIBDIR:-lib}" \
		"INCLUDEDIR=${IMAGE}/usr/include/${PN}" \
		"MAN3DIR=${IMAGE}/usr/share/man/man3"
}

src_install() {
	default

	# Install pkg‐config file
	insinto "/usr/share/pkgconfig/"
	hereins "${PN}.pc" <<EOF
prefix=/usr
libdir=\${prefix}/${LIBDIR:-lib}
includedir=\${prefix}/include/${PN}

Name: ${PN}
Description: A collection of lightweight utility functions
Version: $(head -n 1 CHANGES | grep -E -o '[0-9.]+')
Cflags: -I\${includedir}
Libs: -L\${libdir} -lowfat
EOF

	# Avoid collision with OpenSSL man page
	mv "${IMAGE}"/usr/share/man3/{,owfat-}buffer.h
}
