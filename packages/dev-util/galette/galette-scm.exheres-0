# Copyright MMXIâ€“MMXV
#     Mikael Voss <mvs@nyantec.com>
# Distributed under the terms of the GNU General Public License v2

SUMMARY="Hardening GCC wrapper"
HOMEPAGE="https://github.com/illdefined/${PN}/"
SCM_REPOSITORY="git://github.com/illdefined/${PN}.git"

require scm-git

LICENCES="public-domain"
SLOT="0"
PLATFORMS="~amd64 ~x86"

CROSS_COMPILE_TARGETS="
    i686-pc-linux-gnu
    i686-pc-linux-musl
    x86_64-pc-linux-gnu
    x86_64-pc-linux-musl
    x86_64-pc-linux-gnux32
    x86_64-pc-linux-muslx32"

MYOPTIONS="
    targets: ${CROSS_COMPILE_TARGETS}"

src_install() {
    newbin "${PN}"{.sh,}
    doman "${PN}.1"

    local bindir="/usr/$(exhost --target)/libexec/${PN}"
    dodir "${bindir}"

    for target in ${CROSS_COMPILE_TARGETS}
    do
        if option targets:${target}
        then
            for tool in g{cc,++} clang{,++} cc c++
            do
                dosym "../../bin/${PN}" "${bindir}/${target}-${tool}"
            done

            for tool in ar nm ranlib
            do
                dosym "../../bin/${target}-gcc-${tool}" "${bindir}/${target}-${tool}"
            done
        fi
    done
}
